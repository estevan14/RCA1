"use strict";var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e};jQuery(window).on("elementor:init",function(){var n=window.analog=window.analog||{},t=elementor.settings.page.model.attributes,i=function(e){return!e.startsWith("ang_action")&&(e.startsWith("ang_")||e.startsWith("background"))};function s(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"style",t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"ang_style_settings",n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"page_settings",o=elementor.panel.currentView;o.setPage(n),o.getCurrentPageView().activateTab(e),o.getCurrentPageView().activateSection(t),o.getCurrentPageView().render()}n.showStyleKitAttentionDialog=function(){var e=new elementorModules.editor.utils.Introduction({introductionKey:"angStylekit",dialogType:"confirm",dialogOptions:{id:"ang-stylekit-attention-dialog",headerMessage:ANG_Action.translate.sk_header,message:ANG_Action.translate.sk_message,position:{my:"center center",at:"center center"},strings:{confirm:ANG_Action.translate.sk_learn,cancel:elementor.translate("got_it")},hide:{onButtonClick:!1},onCancel:function(){e.setViewed(),e.getDialog().hide()},onConfirm:function(){e.setViewed(),e.getDialog().hide(),s()}}});e.show()},n.styleKitUpdateDialog=function(){var e=elementorCommon.dialogsManager.createWidget("lightbox",{id:"ang-stylekit-update",headerMessage:ANG_Action.translate.skUpdate,message:ANG_Action.translate.skUpdateDesc,hide:{onOutsideClick:!1,onBackgroundClick:!1,onEscKeyPress:!1}});return e.addButton({name:"ang_discard",text:ANG_Action.translate.discard,callback:function(){n.removeFromQueue(),elementor.settings.page.model.set("ang_action_tokens","-1")}}),e.addButton({name:"ang_apply",text:ANG_Action.translate.apply,callback:function(){n.removeFromQueue(),n.applyStyleKit(t.ang_action_tokens)}}),e},n.StyleKitUpdateModal=n.styleKitUpdateDialog(),n.resetStyles=function(){var e=elementor.settings.page.model.attributes,a={};_.map(e,function(e,t){if(i(t)&&void 0!==elementor.settings.page.model.controls[t])switch(_typeof(elementor.settings.page.model.controls[t].default)){case"string":a[t]="";break;case"boolean":a[t]=!1;break;case"object":var n=elementor.settings.page.model.controls[t].type,o="";"slider"===n&&(o={size:"",sizes:[],unit:"em"}),"dimensions"===n&&(o={unit:"px",top:"",right:"",bottom:"",left:"",isLinked:!0}),a[t]=o;break;default:a[t]=elementor.settings.page.model.controls[t].default}}),elementor.settings.page.model.set(a),elementor.settings.page.model.set("ang_action_tokens",""),s()},n.applyStyleKit=function(e){e?wp.apiFetch({method:"post",path:"agwp/v1/tokens/get",data:{id:e}}).then(function(e){var t=JSON.parse(e.data);Object.keys(t).length&&(elementor.settings.page.model.set(t),elementor.settings.page.model.set("ang_recently_imported","no"))}).catch(function(e){console.error(e)}):console.warn("No value provided.")},n.removeFromQueue=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:elementor.config.document.id;$.ajax({type:"POST",url:AGWP.ajaxurl,data:{action:"ang_remove_kit_queue",id:e},success:function(e){e.success||elementorCommon.dialogsManager.createWidget("alert",{message:e.data.message}).show()},dataType:"JSON"})},elementor.on("preview:loaded",function(){elementor.config.user.introduction.angStylekit||n.showStyleKitAttentionDialog();var e=elementor.settings.page.model.attributes;(e.ang_action_tokens&&"-1"!==e.ang_action_tokens&&n.applyStyleKit(e.ang_action_tokens),AGWP.stylekit_queue)&&(AGWP.stylekit_queue.find(function(e){return e===elementor.config.document.id})&&!n.StyleKitUpdateModal.isVisible()&&n.StyleKitUpdateModal.show())});var o=elementor.modules.controls.BaseData,e=o.extend({initialize:function(e){o.prototype.initialize.apply(this,arguments),this.elementSettingsModel=e.elementSettingsModel,"update_token"===this.model.get("action")&&this.listenTo(this.elementSettingsModel,"change",this.toggleControlVisibility)},toggleControlVisibility:function(){"update_token"===this.model.get("action")&&(this.$el.find("button").attr("disabled",!0),Object.keys(this.elementSettingsModel.changed).length&&this.$el.find("button").attr("disabled",!1))},ui:function(){var e=o.prototype.ui.apply(this,arguments);return _.extend(e,{actionButton:"button"}),e},events:function(){var e=o.prototype.events.apply(this,arguments);return e["click @ui.actionButton"]="onChangeEvent",e},performAction:function(e){return this[{export_css:"handleCSSExport",reset_css:"handleCSSReset",save_token:"handleSaveToken",update_token:"handleTokenUpdate"}[e]]()},onChangeEvent:function(e){var t=e.currentTarget,n=jQuery(t).data("action");this.performAction(n)},handleCSSExport:function(){var e=elementor.settings.page.getControlsCSS().elements.$stylesheetElement[0].textContent,t=elementor.settings.page.model.get("custom_css"),n=e.replace(t,""),o=cssbeautify(n,{indent:"  ",openbrace:"end-of-line",autosemicolon:!0}),a=elementorCommon.dialogsManager.createWidget("lightbox",{id:"ang-modal-export-css",headerMessage:ANG_Action.translate.exportCSS,message:"",position:{my:"center",at:"center"},onReady:function(){this.addButton({name:"cancel",text:elementor.translate("cancel"),callback:function(){a.destroy()}}),this.addButton({name:"ok",text:ANG_Action.translate.copyCSS,callback:function(){var e=a.getElements("content");$(e.find("textarea")).select(),document.execCommand("copy")}})},onShow:function(){a.getElements("content").append('<textarea rows="10">'+o+"</textarea>")}});a.getElements("message").append(a.addElement("content")),a.show(),jQuery(window).resize()},handleCSSReset:function(){elementorCommon.dialogsManager.createWidget("confirm",{message:ANG_Action.translate.resetMessage,headerMessage:ANG_Action.translate.resetHeader,strings:{confirm:elementor.translate("yes"),cancel:elementor.translate("cancel")},defaultOption:"cancel",onConfirm:n.resetStyles}).show()},handleSaveToken:function(){var e=elementor.settings.page.model.attributes,n={};elementor.saver.defaultSave(),_.map(e,function(e,t){i(t)&&(n[t]=e)});var o=elementorCommon.dialogsManager.createWidget("lightbox",{id:"ang-modal-save-token",headerMessage:ANG_Action.translate.saveToken,message:"",position:{my:"center",at:"center"},onReady:function(){this.addButton({name:"cancel",text:ANG_Action.translate.cancel,callback:function(){o.destroy()}}),this.addButton({name:"ok",text:ANG_Action.translate.saveToken2,callback:function(e){var t=e.getElements("content").find("#ang_token_title").val();t&&wp.apiFetch({url:ANG_Action.saveToken,method:"post",data:{id:elementor.config.post_id,title:t,tokens:JSON.stringify(n)}}).then(function(e){elementor.settings.page.model.controls.ang_action_tokens.options[e.id]=t,elementor.reloadPreview(),setTimeout(function(){o.destroy(),elementor.settings.page.model.set("ang_action_tokens",e.id),s()},2e3)}).catch(function(e){console.error(e.message)})}})},onShow:function(){o.getElements("content").append('\n\t\t\t\t\t\t<input id="ang_token_title" type="text" value="" placeholder="'+ANG_Action.translate.enterTitle+'" />\n\t\t\t\t\t')}});o.getElements("message").append(o.addElement("content")),o.show(),jQuery(window).resize()},handleTokenUpdate:function(){var e=elementor.settings.page.model.attributes.ang_action_tokens,t=elementor.config.post_id,n=elementor.settings.page.model.attributes,o={};elementor.saver.defaultSave(),_.map(n,function(e,t){i(t)&&(o[t]=e)});var a=elementorCommon.dialogsManager.createWidget("confirm",{message:ANG_Action.translate.updateMessage,headerMessage:ANG_Action.translate.updateKit,strings:{confirm:elementor.translate("yes"),cancel:elementor.translate("cancel")},defaultOption:"cancel",onConfirm:function(){wp.apiFetch({path:"agwp/v1/tokens/update",method:"post",data:{id:e,current_id:t,tokens:JSON.stringify(o)}}).then(function(){elementor.notifications.showToast({message:ANG_Action.translate.tokenUpdated})}).catch(function(e){return console.error(e)})}});a.getElements("message").append(a.addElement("content")),a.show()}});elementor.addControlView("ang_action",e),elementor.settings.page.addChangeCallback("ang_action_tokens",function(e){n.applyStyleKit(e)}),jQuery(document).on("heartbeat-tick",function(e,t){t.stylekit_queue&&(t.stylekit_queue.find(function(e){return e===elementor.config.document.id})&&!n.StyleKitUpdateModal.isVisible()&&n.StyleKitUpdateModal.show())})});